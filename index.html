<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XEROX | TemplateHub</title>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <style>
body {font-family: Arial, sans-serif; background-color: white; color: #333; margin: 0; padding: 20px; transition: background 0.5s;}
.container {display: flex; gap: 20px;}
.panel {background: #f9f9f9; padding: 20px; border-radius: 8px; width: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
h2 {margin-top: 0;}
label {display: block; margin: 10px 0 5px;}
select, input, textarea {width: 100%; padding: 8px; border: 1px solid #aaa; border-radius: 4px; margin-bottom: 10px;}
textarea {resize: vertical; min-height: 30px;}
button {margin-top: 10px; padding: 10px; background-color: #D92231; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; transition: background 0.3s;}
button:hover {background-color: #ae1e2a;}
.output-container {background: #fff; border: 1px solid #ddd; padding: 10px; border-radius: 8px; min-height: 150px; overflow-y: auto; white-space: pre-wrap;}
.highlight {color: #d63384; font-weight: bold;}
.copy-btn {display: flex; align-items: center; justify-content: center; background-color: #696969; border: none; padding: 8px 12px; cursor: pointer; border-radius: 5px; font-size: 14px; transition: background 0.3s;}
.copy-btn:hover {background-color: #545454;}
.copy-btn::after {content: "Copy"; padding-left: 8px;}
.footer {display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; margin-top: 50px; background-color: transparent;}
.footer-desc {margin-bottom: 10px; font-size: 14px; color: #555;}
  </style>
</head>
<body>
   <h1 style="color:#D92231">XEROX TemplateHub</h1>

<div class="container">
  <div class="panel">
    <h3>Select Email Template:</h3>
    <label for="categorySelect">Template Description:</label>
    <select id="categorySelect"><option value="">-- Select Category --</option></select>
    <label for="templateSelect">Template:</label>
    <select id="templateSelect"><option value="">-- Select Template --</option></select>
    <div id="inputFields"></div>
    <button id="generateBtn">Generate Template</button>
  </div>

  <div class="panel">
    <h3>Generated Email Template:</h3>
    <div class="output-container" id="output"></div>
    <button class="copy-btn" id="copyBtn"></button>
  </div>
</div>

<div class="footer">
  <div class="footer-desc" id="footerDesc"></div>
  <div class="footer-cnx-logo">
    <img src="/images/concentrix_logo.png" alt="Concentrix Logo" width="150px">
  </div>
</div>

<script>
// Helper functions
function escapeHtml(str) {
  if (!str) return "";
  return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function parseRecipients(r){return r? r.split(/[;,]+/).map(x=>x.trim()).filter(Boolean):[];}

// Template data (shortened to one example category for brevity)
const emailCategories = {
  "DL": {
    "No Contact on XSM": {
      contactEmail: "can.mps.delivery.team@xerox6643.zendesk.com",
      subject: "No Contact Info on XSM <TicketNumber>",
      template: "Hi Team,\n\nCustomer requesting a Contact Information Update.\n\n(Note: Indicate if this needs to be completed for to place a service call)\n\nPlease see details below:\n\nCompany Name: <CompanyName>\nSerial Number: <SNNumber>\nMachine Model: <MachineModel>\nIncident Ticket Number: <IncidentTicketNumber>\n\nThank you.\n\nRegards,",
      bgColor: "lightblue"
    }
  }
};

document.addEventListener("DOMContentLoaded", () => {
  const categorySelect = document.getElementById("categorySelect");
  const templateSelect = document.getElementById("templateSelect");
  const inputFieldsDiv = document.getElementById("inputFields");
  const outputDiv = document.getElementById("output");
  const copyBtn = document.getElementById("copyBtn");
  const generateBtn = document.getElementById("generateBtn");
  const footerDesc = document.getElementById("footerDesc");
  footerDesc.textContent = new Date().getFullYear() + " | Powered by: Innovation Team";

  Object.keys(emailCategories).forEach(cat=>{
    const o=document.createElement("option");o.value=cat;o.textContent=cat;categorySelect.appendChild(o);
  });

  categorySelect.addEventListener("change",()=>{
    templateSelect.innerHTML="<option value=''>-- Select Template --</option>";
    const t=emailCategories[categorySelect.value];if(!t)return;
    Object.keys(t).forEach(x=>{const o=document.createElement("option");o.value=x;o.textContent=x;templateSelect.appendChild(o);});
  });

  templateSelect.addEventListener("change",()=>{
    inputFieldsDiv.innerHTML="";const s=emailCategories[categorySelect.value]?.[templateSelect.value];if(!s)return;
    document.body.style.backgroundColor=s.bgColor;
    const matches=Array.from(new Set((s.subject.match(/<[^>]+>/g)||[]).concat(s.template.match(/<[^>]+>/g)||[])));
    matches.forEach(m=>{
      if(inputFieldsDiv.querySelector('[data-key="'+m+'"]'))return;
      const label=document.createElement("label");label.textContent=m.replace(/[<>]/g,"");
      const ta=document.createElement("textarea");ta.setAttribute("data-key",m);
      inputFieldsDiv.appendChild(label);inputFieldsDiv.appendChild(ta);
    });
  });

  generateBtn.addEventListener("click",()=>{
    const s=emailCategories[categorySelect.value]?.[templateSelect.value];if(!s)return;
    let subj=s.subject,body=s.template;
    inputFieldsDiv.querySelectorAll("textarea").forEach(i=>{const k=i.getAttribute("data-key");const v=escapeHtml(i.value);subj=subj.replaceAll(k,v);body=body.replaceAll(k,v);});
    const bodyHtml=body.replace(/\n/g,"<br>");
    if(window.Office && Office.context && Office.context.mailbox){
      const item=Office.context.mailbox.item;
      item.to.setAsync(parseRecipients(s.contactEmail));
      item.subject.setAsync(subj);
      item.body.setAsync(bodyHtml,{coercionType:Office.CoercionType.Html});
      alert("Email populated in Outlook.");
    } else {
      outputDiv.innerHTML="<b>Contact:</b> "+s.contactEmail+"<br><b>Subject:</b> "+subj+"<br><br>"+bodyHtml;
    }
  });

  copyBtn.addEventListener("click",()=>{
    navigator.clipboard.writeText(outputDiv.innerText).then(()=>alert("Copied!"));
  });
});
</script>
</body>
</html>